#include "spew.h"


/**
 * The log utility for precise error message.
 *
 * @param cszPathSrc        The source file path of the invoking site.
 * @param iLineNo           The source file line number of the invoking site.
 * @param cszFunc           The function name of the invoking site.
 * @param cszFormat         The string formatter.
 * @param ...               The parameters of the string formatter.
 */
void WriteLog(const char* cszPathSrc, int iLineNo, const char* cszFunc, const char* cszFormat, ...) {
    char      szLogBuf[LOG_BUF_SIZE];
    int       iLen;
    time_t    nTime;        
    va_list   varArgument;
    char      *szTime;    
    struct tm *tmTime;

    memset(szLogBuf, 0, sizeof(char) * LOG_BUF_SIZE);
    va_start(varArgument, cszFormat);
    iLen = vsnprintf(szLogBuf, sizeof(szLogBuf), cszFormat, varArgument);
    va_end(varArgument);

    if((iLen == -1) || (iLen >= (int)sizeof(szLogBuf))) {
	    iLen = sizeof(szLogBuf) - 1;
	    szLogBuf[iLen] = 0;
    } else if(iLen == 0) {
	    iLen = 0;
	    szLogBuf[0] = 0;
    }

    time(&nTime);
    tmTime = localtime(&nTime);
    szTime = asctime(tmTime);

    printf("[%s, %d, %s] %s%s", cszPathSrc, iLineNo, cszFunc, szTime, szLogBuf);

    return;
}
